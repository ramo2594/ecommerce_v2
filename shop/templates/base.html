<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}E-Commerce Django{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    {% load static %}
    <link href="{% static 'css/main.css' %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white">
    {% include "components/navbar.html" %}
    {% include "components/messages.html" %}

    <main class="container my-5 min-vh-100">
        {% block content %}{% endblock %}
    </main>

    {% include "components/footer.html" %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Global JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-dismiss success/info alerts
        const alerts = document.querySelectorAll('.alert:not(.alert-danger)');
        alerts.forEach(alert => {
            setTimeout(() => {
                alert.style.transition = 'opacity 0.5s ease';
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 500);
            }, 5000);
        });
        
        // Update cart badge count
        updateCartCount();
    });
    
    function updateCartCount() {
        fetch('{% url "shop:cart-api-count" %}')
            .then(response => response.json())
            .then(data => {
                const badge = document.getElementById('cart-count');
                if (badge) {
                    badge.textContent = data.count;
                    badge.style.display = data.count === 0 ? 'none' : 'inline-block';
                }
            })
            .catch(() => {});  // Silent fail
    }
    
    // Update cart after add-to-cart form submit
    document.addEventListener('submit', function(e) {
        if (e.target.matches('#add-to-cart-form, [name*="cart"]')) {
            setTimeout(updateCartCount, 500);
        }
    });
    </script>
    
    <!-- Page-specific JavaScript -->
    {% block extra_js %}{% endblock %}
</body>
</html>
