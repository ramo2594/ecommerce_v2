{% extends "base.html" %}

{% block title %}{{ product.name }} - E-Commerce{% endblock %}

{% block content %}
<div class="row g-5">
    <!-- PRODUCT IMAGE + INFO -->
    <div class="col-lg-6">
        <!-- IMAGE GALLERY -->
        <div class="position-relative mb-4">
            {% if product.image %}
                <img src="{{ product.image.url }}" 
                     class="img-fluid rounded shadow-lg" 
                     alt="{{ product.name }}"
                     style="max-height: 500px; object-fit: cover;">
            {% else %}
                <div class="bg-light rounded shadow-lg d-flex align-items-center justify-content-center" 
                     style="height: 500px;">
                    <div class="text-center text-muted">
                        <i class="fas fa-image fa-5x opacity-50 mb-3"></i>
                        <p class="fs-5">Immagine non disponibile</p>
                    </div>
                </div>
            {% endif %}
        </div>
        
        <!-- STOCK STATUS -->
        <div class="mb-3">
            {% if product.is_in_stock %}
                <span class="badge bg-success fs-6 px-3 py-2">
                    <i class="fas fa-check-circle me-1"></i>
                    Disponibile ({{ product.stock }} pezzi)
                </span>
            {% else %}
                <span class="badge bg-danger fs-6 px-3 py-2">
                    <i class="fas fa-times-circle me-1"></i>
                    Esaurito
                </span>
            {% endif %}
        </div>
    </div>

    <!-- PRODUCT DETAILS -->
    <div class="col-lg-6">
        <div class="sticky-top" style="top: 100px;">
            <!-- BREADCRUMBS -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{% url 'shop:product-list' %}">Prodotti</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        {{ product.category.name }}
                    </li>
                </ol>
            </nav>
            
            <!-- NAME -->
            <h1 class="display-4 fw-bold mb-4 lh-1">{{ product.name }}</h1>
            
            <!-- PRICE -->
            <div class="d-flex align-items-baseline mb-4 pb-3 border-bottom">
                <span class="h2 text-success fw-bold mb-0 me-3">
                    €{{ product.price|floatformat:2 }}
                </span>
                <span class="text-muted fs-5">IVA inclusa</span>
            </div>
            
            <!-- DESCRIPTION -->
            <div class="mb-4">
                <h5><i class="fas fa-info-circle me-2 text-primary"></i>Descrizione</h5>
                <div class="p-3 bg-light rounded">
                    {{ product.description|linebreaks }}
                </div>
            </div>
            
            <!-- STOCK & AVAILABILITY -->
            <div class="row mb-4 g-3">
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Quantità:</label>
                    <div class="input-group">
                        <button class="btn btn-outline-secondary" type="button" id="qty-minus">-</button>
                        <input type="number" class="form-control text-center" id="qty-input" 
                               value="1" min="1" max="{{ product.stock }}">
                        <button class="btn btn-outline-secondary" type="button" id="qty-plus">+</button>
                    </div>
                    <small class="text-muted">{{ product.stock }} pezzi disponibili</small>
                </div>
            </div>
            
            <!-- ADD TO CART BUTTON -->
            {% if product.is_in_stock %}
                <form method="post" action="{% url 'shop:add-to-cart' product.id %}" id="add-to-cart-form">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-lg w-100 mb-3 shadow-lg">
                        <i class="fas fa-shopping-cart me-2"></i>
                        Aggiungi al Carrello
                    </button>
                </form>
            {% else %}
                <button class="btn btn-outline-secondary btn-lg w-100 disabled mb-3">
                    <i class="fas fa-ban me-2"></i>
                    Non Disponibile
                </button>
            {% endif %}
            
            <!-- SHARE & BACK -->
            <div class="d-flex gap-2">
                <a href="{% url 'shop:product-list' %}" class="btn btn-outline-primary btn-sm flex-grow-1">
                    <i class="fas fa-arrow-left me-1"></i>Torna ai Prodotti
                </a>
                <button class="btn btn-outline-secondary btn-sm" onclick="navigator.clipboard.writeText(window.location.href)">
                    <i class="fas fa-share me-1"></i>Condividi
                </button>
            </div>
        </div>
    </div>
</div>

<!-- RELATED PRODUCTS (bonus) -->
<section class="mt-5">
    <h3 class="h4 mb-4 pb-2 border-bottom">
        <i class="fas fa-thumbs-up me-2 text-warning"></i>
        Prodotti Simili
    </h3>
    <div class="row g-3">
        {% for related in product.category.products.all|slice:":4" %}
            {% if related != product %}
            <div class="col-md-3">
                <div class="card h-100">
                    {% if related.image %}
                        <img src="{{ related.image.url }}" class="card-img-top" alt="{{ related.name }}" style="height: 150px; object-fit: cover;">
                    {% endif %}
                    <div class="card-body p-3">
                        <h6 class="card-title mb-2">{{ related.name }}</h6>
                        <div class="d-flex justify-content-between">
                            <span class="fw-bold text-success">€{{ related.price }}</span>
                            <a href="{{ related.get_absolute_url }}" class="btn btn-sm btn-outline-primary">Vedi</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        {% empty %}
            <div class="col-12">
                <p class="text-muted text-center py-4">Nessun prodotto simile al momento.</p>
            </div>
        {% endfor %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const qtyInput = document.getElementById('qty-input');
    const qtyMinus = document.getElementById('qty-minus');
    const qtyPlus = document.getElementById('qty-plus');
    
    const maxQty = parseInt(qtyInput.max);
    
    qtyMinus.addEventListener('click', () => {
        if (qtyInput.value > 1) {
            qtyInput.value = parseInt(qtyInput.value) - 1;
        }
    });
    
    qtyPlus.addEventListener('click', () => {
        if (qtyInput.value < maxQty) {
            qtyInput.value = parseInt(qtyInput.value) + 1;
        }
    });
});
</script>
{% endblock %}
