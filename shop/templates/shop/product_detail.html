{% extends "base.html" %}

{% block title %}{{ product.name }} - E-Commerce{% endblock %}

{% block content %}
<div class="row g-5 align-items-start">
    <!-- PRODUCT IMAGE SECTION -->
    <div class="col-lg-6">
        <!-- IMAGE GALLERY -->
        <div class="position-relative mb-4">
            {% if product.image %}
                <img src="{{ product.image.url }}" 
                     class="img-fluid rounded shadow-lg w-100" 
                     alt="{{ product.name }}"
                     style="max-height: 550px; object-fit: cover;">
            {% else %}
                <div class="bg-light rounded shadow-lg d-flex align-items-center justify-content-center w-100" 
                     style="height: 550px;">
                    <div class="text-center text-secondary">
                        <i class="fas fa-image fa-5x mb-3 opacity-50"></i>
                        <p class="fs-5 fw-semibold">Image Not Available</p>
                    </div>
                </div>
            {% endif %}
        </div>
        
        <!-- STOCK STATUS BADGE -->
        <div class="mb-3">
            {% if product.is_in_stock %}
                <span class="badge bg-success fs-6 px-3 py-2">
                    <i class="fas fa-check-circle me-2"></i>
                    In Stock ({{ product.stock }} units)
                </span>
            {% else %}
                <span class="badge bg-danger fs-6 px-3 py-2">
                    <i class="fas fa-times-circle me-2"></i>
                    Out of Stock
                </span>
            {% endif %}
        </div>
    </div>

    <!-- PRODUCT DETAILS SECTION -->
    <div class="col-lg-6">
        <div class="sticky-top" style="top: 100px;">
            <!-- BREADCRUMBS -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb small">
                    <li class="breadcrumb-item">
                        <a href="{% url 'shop:product-list' %}" class="text-decoration-none">Products</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="?category={{ product.category.slug }}" class="text-decoration-none">
                            {{ product.category.name }}
                        </a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        {{ product.name }}
                    </li>
                </ol>
            </nav>
            
            <!-- PRODUCT NAME -->
            <h1 class="display-5 fw-bold mb-3 lh-1">{{ product.name }}</h1>
            
            <!-- CATEGORY BADGE -->
            <div class="mb-3">
                <span class="badge bg-light text-dark">{{ product.category.name }}</span>
            </div>
            
            <!-- PRICE SECTION -->
            <div class="d-flex align-items-baseline mb-4 pb-3 border-bottom-2">
                <span class="h2 text-primary fw-bold mb-0 me-3">
                    €{{ product.price|floatformat:2 }}
                </span>
                <span class="text-muted fs-6">VAT included</span>
            </div>
            
            <!-- DESCRIPTION -->
            <div class="mb-4">
                <h5 class="fw-semibold mb-2">
                    <i class="fas fa-info-circle me-2 text-primary"></i>Description
                </h5>
                <div class="p-3 bg-light rounded border-start border-4 border-primary">
                    {{ product.description|linebreaks }}
                </div>
            </div>
            
            <!-- QUANTITY SELECTOR -->
            <div class="mb-4">
                <label class="form-label fw-semibold">Quantity:</label>
                <div class="input-group input-group-lg">
                    <button class="btn btn-outline-secondary" type="button" id="qty-minus" aria-label="Decrease quantity">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" 
                           class="form-control text-center fw-semibold" 
                           id="qty-input" 
                           value="1" 
                           min="1" 
                           max="{{ product.stock }}"
                           aria-label="Product quantity">
                    <button class="btn btn-outline-secondary" type="button" id="qty-plus" aria-label="Increase quantity">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                {% if product.stock > 0 %}
                    <small class="text-muted d-block mt-2">
                        <i class="fas fa-box me-1"></i>{{ product.stock }} units available
                    </small>
                {% endif %}
            </div>
            
            <!-- ADD TO CART BUTTON -->
            {% if product.is_in_stock %}
                <form method="post" action="{% url 'shop:add-to-cart' product.id %}" id="add-to-cart-form" class="mb-3">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" id="quantity-input" value="1">
                    <button type="submit" class="btn btn-primary btn-lg w-100 shadow-lg">
                        <i class="fas fa-shopping-cart me-2"></i>
                        Add to Cart
                    </button>
                </form>
            {% else %}
                <button class="btn btn-secondary btn-lg w-100 disabled mb-3" disabled>
                    <i class="fas fa-ban me-2"></i>
                    Not Available
                </button>
            {% endif %}
            
            <!-- ACTION BUTTONS -->
            <div class="d-flex gap-2">
                <a href="{% url 'shop:product-list' %}" class="btn btn-outline-primary flex-grow-1">
                    <i class="fas fa-arrow-left me-2"></i>Back to Products
                </a>
                <button class="btn btn-outline-secondary" 
                        id="share-btn"
                        title="Copy link to clipboard">
                    <i class="fas fa-share-alt me-1"></i>Share
                </button>
            </div>
        </div>
    </div>
</div>

<!-- RELATED PRODUCTS SECTION -->
{% if related_products %}
<section class="mt-5 pt-5 border-top">
    <h2 class="h4 mb-4 fw-bold">
        <i class="fas fa-star me-2 text-warning"></i>
        Related Products
    </h2>
    <div class="row g-4">
        {% for related in related_products %}
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 shadow-sm border-0 hover-lift transition-all">
                {% if related.image %}
                    <div class="position-relative overflow-hidden" style="height: 200px;">
                        <img src="{{ related.image.url }}" 
                             class="card-img-top w-100 h-100" 
                             alt="{{ related.name }}"
                             style="object-fit: cover;">
                    </div>
                {% endif %}
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title fw-semibold mb-2">
                        <a href="{{ related.get_absolute_url }}" class="text-decoration-none text-dark">
                            {{ related.name }}
                        </a>
                    </h6>
                    <div class="mt-auto d-flex justify-content-between align-items-center">
                        <span class="fw-bold text-primary">€{{ related.price|floatformat:2 }}</span>
                        <a href="{{ related.get_absolute_url }}" class="btn btn-sm btn-outline-primary">
                            View <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const qtyInput = document.getElementById('qty-input');
    const quantityInput = document.getElementById('quantity-input');
    const qtyMinus = document.getElementById('qty-minus');
    const qtyPlus = document.getElementById('qty-plus');
    const shareBtn = document.getElementById('share-btn');
    
    const maxQty = parseInt(qtyInput.max) || 999;
    
    // Update hidden input when quantity changes
    const updateQuantity = () => {
        const value = Math.max(1, Math.min(parseInt(qtyInput.value) || 1, maxQty));
        qtyInput.value = value;
        quantityInput.value = value;
    };
    
    // Quantity decrease
    qtyMinus.addEventListener('click', () => {
        qtyInput.value = Math.max(1, parseInt(qtyInput.value) - 1);
        updateQuantity();
    });
    
    // Quantity increase
    qtyPlus.addEventListener('click', () => {
        qtyInput.value = Math.min(maxQty, parseInt(qtyInput.value) + 1);
        updateQuantity();
    });
    
    // Direct input validation
    qtyInput.addEventListener('change', updateQuantity);
    
    // Share button
    shareBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(window.location.href).then(() => {
            const originalText = shareBtn.innerHTML;
            shareBtn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
            shareBtn.classList.add('btn-success');
            shareBtn.classList.remove('btn-outline-secondary');
            setTimeout(() => {
                shareBtn.innerHTML = originalText;
                shareBtn.classList.remove('btn-success');
                shareBtn.classList.add('btn-outline-secondary');
            }, 2000);
        });
    });
});
</script>
{% endblock %}
